{% extends "base.html" %}
{% load static %}
{% load widget_tweaks %}

{% block content %}
<div class="bg-white p-8 rounded-xl shadow-md border border-gray-200 max-w-3xl mx-auto">
    <h2 class="text-3xl font-bold text-gray-800 mb-8">Cambiar Firma Digital</h2>

    <form method="post" enctype="multipart/form-data">
        {% csrf_token %}
        <div class="grid grid-cols-1 md:grid-cols-2 gap-8 items-start">
            
            <div class="text-center">
                <h3 class="text-lg font-semibold text-gray-700 mb-2">Firma Actual</h3>
                <div id="current-image-container">
                    {% if user.firma_digital %}
                        <div class="bg-gray-100 p-4 rounded-lg inline-block border">
                            <img src="{{ user.firma_digital.url }}" alt="Firma actual" class="w-48 h-auto mx-auto">
                        </div>
                    {% else %}
                        <p id="no-image-text" class="text-gray-500 italic">No tienes una firma digital.</p>
                    {% endif %}
                </div>
                
                <div id="preview-container" class="hidden mt-6">
                    <h3 class="text-lg font-semibold text-gray-700 mb-2">Nueva Firma</h3>
                    <div class="bg-gray-100 p-4 rounded-lg inline-block border">
                        <img id="image-preview" src="#" alt="Previsualización" class="w-48 h-auto mx-auto">
                    </div>
                </div>
            </div>

            <div class="md:border-l border-gray-200 md:pl-8">
                <h3 class="text-lg font-semibold text-gray-700">Actualizar archivo</h3>
                <p class="text-gray-600 mt-1 mb-4">Selecciona una nueva imagen (PNG) para tu firma.</p>
                
                {{ form.firma_digital|add_class:"hidden" }}

                <div class="flex items-center space-x-2">
                    <label for="{{ form.firma_digital.id_for_label }}" class="cursor-pointer bg-white border border-gray-300 text-gray-700 font-bold py-2 px-4 rounded-lg hover:bg-gray-50 transition duration-300">
                        <span>Seleccionar archivo</span>
                    </label>
                </div>
                <span id="file-name" class="text-gray-500 text-sm mt-2 block truncate max-w-xs">Ningún archivo seleccionado</span>
                
                <button type="submit" class="w-full mt-8 bg-empresa-green text-white font-bold py-3 px-4 rounded-lg hover:bg-opacity-90 transition duration-300">
                    Guardar Cambios
                </button>
            </div>
        </div>
    </form>
</div>

<script>
    const imageInput = document.getElementById('{{ form.firma_digital.id_for_label }}');
    const imagePreview = document.getElementById('image-preview');
    const previewContainer = document.getElementById('preview-container');
    const fileNameSpan = document.getElementById('file-name');
    const currentImageContainer = document.getElementById('current-image-container');

    imageInput.addEventListener('change', function() {
        const file = this.files[0];
        if (file) {
            fileNameSpan.textContent = file.name;
            const reader = new FileReader();
            previewContainer.classList.remove('hidden');
            reader.onload = (e) => imagePreview.setAttribute('src', e.target.result);
            reader.readAsDataURL(file);
            currentImageContainer.classList.add('hidden');
        }
    });
</script>
{% endblock content %}